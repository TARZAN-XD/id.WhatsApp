<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>واتساب ويب بسيط</title>
  <style>
    body { font-family: Arial; display: flex; }
    #sidebar { width: 250px; border-right: 1px solid #ccc; padding: 10px; }
    #chat { flex: 1; padding: 10px; }
    img { width: 200px; }
    .chat-item { padding: 5px; cursor: pointer; border-bottom: 1px solid #eee; }
  </style>
</head>
<body>
  <div id="sidebar">
    <h3>المحادثات</h3>
    <div id="chatList">جارٍ التحميل...</div>
  </div>
  <div id="chat">
    <h3>المحادثة</h3>
    <div id="messages"></div>
  </div>

  <div id="qr"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const chatListDiv = document.getElementById('chatList');
    const messagesDiv = document.getElementById('messages');
    const qrDiv = document.getElementById('qr');

    socket.on('qr', (qr) => {
      qrDiv.innerHTML = `<h3>امسح QR لربط واتساب:</h3><img src="${qr}" />`;
    });

    socket.on('chats', (chats) => {
      chatListDiv.innerHTML = '';
      chats.forEach(chat => {
        const div = document.createElement('div');
        div.className = 'chat-item';
        div.textContent = chat.name;
        div.onclick = () => {
          socket.emit('getMessages', chat.id);
        };
        chatListDiv.appendChild(div);
      });
    });

    socket.on('messages', ({ jid, messages }) => {
      messagesDiv.innerHTML = '';
      messages.forEach(m => {
        const text = m.message?.conversation || '[رسالة غير نصية]';
        const p = document.createElement('p');
        p.textContent = text;
        messagesDiv.appendChild(p);
      });
    });
  </script>
</body>
</html>
